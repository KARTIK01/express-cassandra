'use strict';

var fs = require('fs');
var p = require('path');

function readdir(path, callback) {

  var list = [];

  fs.readdir(path, function (err, files) {
    if (err) {
      return callback(err);
    }

    var pending = files.length;
    if (!pending) {
      // we are done, woop woop
      return callback(null, list);
    }

    files.forEach(function (file) {
      var filePath = p.join(path, file);
      fs.stat(filePath, function (_err, stats) {
        if (_err) {
          return callback(_err);
        }

        if (stats.isDirectory()) {
          readdir(filePath, function (__err, res) {
            if (__err) {
              return callback(__err);
            }

            list = list.concat(res);
            pending -= 1;
            if (!pending) {
              return callback(null, list);
            }
          });
        } else {
          list.push(filePath);
          pending -= 1;
          if (!pending) {
            return callback(null, list);
          }
        }
      });
    });
  });
}

module.exports = readdir;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9yZWFkRm9sZGVyUmVjdXJzaXZlLmpzIl0sIm5hbWVzIjpbImZzIiwicmVxdWlyZSIsInAiLCJyZWFkZGlyIiwicGF0aCIsImNhbGxiYWNrIiwibGlzdCIsImVyciIsImZpbGVzIiwicGVuZGluZyIsImxlbmd0aCIsImZvckVhY2giLCJmaWxlIiwiZmlsZVBhdGgiLCJqb2luIiwic3RhdCIsIl9lcnIiLCJzdGF0cyIsImlzRGlyZWN0b3J5IiwiX19lcnIiLCJyZXMiLCJjb25jYXQiLCJwdXNoIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxLQUFLQyxRQUFRLElBQVIsQ0FBVDtBQUNBLElBQUlDLElBQUtELFFBQVEsTUFBUixDQUFUOztBQUdBLFNBQVNFLE9BQVQsQ0FBaUJDLElBQWpCLEVBQXVCQyxRQUF2QixFQUFpQzs7QUFFL0IsTUFBSUMsT0FBTyxFQUFYOztBQUVBTixLQUFHRyxPQUFILENBQVdDLElBQVgsRUFBaUIsVUFBVUcsR0FBVixFQUFlQyxLQUFmLEVBQXNCO0FBQ3JDLFFBQUlELEdBQUosRUFBUztBQUNQLGFBQU9GLFNBQVNFLEdBQVQsQ0FBUDtBQUNEOztBQUVELFFBQUlFLFVBQVVELE1BQU1FLE1BQXBCO0FBQ0EsUUFBSSxDQUFDRCxPQUFMLEVBQWM7QUFDWjtBQUNBLGFBQU9KLFNBQVMsSUFBVCxFQUFlQyxJQUFmLENBQVA7QUFDRDs7QUFFREUsVUFBTUcsT0FBTixDQUFjLFVBQVVDLElBQVYsRUFBZ0I7QUFDNUIsVUFBSUMsV0FBV1gsRUFBRVksSUFBRixDQUFPVixJQUFQLEVBQWFRLElBQWIsQ0FBZjtBQUNBWixTQUFHZSxJQUFILENBQVFGLFFBQVIsRUFBa0IsVUFBVUcsSUFBVixFQUFnQkMsS0FBaEIsRUFBdUI7QUFDdkMsWUFBSUQsSUFBSixFQUFVO0FBQ1IsaUJBQU9YLFNBQVNXLElBQVQsQ0FBUDtBQUNEOztBQUVELFlBQUlDLE1BQU1DLFdBQU4sRUFBSixFQUF5QjtBQUN2QmYsa0JBQVFVLFFBQVIsRUFBa0IsVUFBVU0sS0FBVixFQUFpQkMsR0FBakIsRUFBc0I7QUFDdEMsZ0JBQUlELEtBQUosRUFBVztBQUNULHFCQUFPZCxTQUFTYyxLQUFULENBQVA7QUFDRDs7QUFFRGIsbUJBQU9BLEtBQUtlLE1BQUwsQ0FBWUQsR0FBWixDQUFQO0FBQ0FYLHVCQUFXLENBQVg7QUFDQSxnQkFBSSxDQUFDQSxPQUFMLEVBQWM7QUFDWixxQkFBT0osU0FBUyxJQUFULEVBQWVDLElBQWYsQ0FBUDtBQUNEO0FBQ0YsV0FWRDtBQVdELFNBWkQsTUFZTztBQUNMQSxlQUFLZ0IsSUFBTCxDQUFVVCxRQUFWO0FBQ0FKLHFCQUFXLENBQVg7QUFDQSxjQUFJLENBQUNBLE9BQUwsRUFBYztBQUNaLG1CQUFPSixTQUFTLElBQVQsRUFBZUMsSUFBZixDQUFQO0FBQ0Q7QUFDRjtBQUVGLE9BekJEO0FBMEJELEtBNUJEO0FBNkJELEdBeENEO0FBeUNEOztBQUVEaUIsT0FBT0MsT0FBUCxHQUFpQnJCLE9BQWpCIiwiZmlsZSI6InJlYWRGb2xkZXJSZWN1cnNpdmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZnMgPSByZXF1aXJlKCdmcycpXG52YXIgcCAgPSByZXF1aXJlKCdwYXRoJylcblxuXG5mdW5jdGlvbiByZWFkZGlyKHBhdGgsIGNhbGxiYWNrKSB7XG5cbiAgdmFyIGxpc3QgPSBbXTtcblxuICBmcy5yZWFkZGlyKHBhdGgsIGZ1bmN0aW9uIChlcnIsIGZpbGVzKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKGVycilcbiAgICB9XG5cbiAgICB2YXIgcGVuZGluZyA9IGZpbGVzLmxlbmd0aDtcbiAgICBpZiAoIXBlbmRpbmcpIHtcbiAgICAgIC8vIHdlIGFyZSBkb25lLCB3b29wIHdvb3BcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCBsaXN0KVxuICAgIH1cblxuICAgIGZpbGVzLmZvckVhY2goZnVuY3Rpb24gKGZpbGUpIHtcbiAgICAgIHZhciBmaWxlUGF0aCA9IHAuam9pbihwYXRoLCBmaWxlKVxuICAgICAgZnMuc3RhdChmaWxlUGF0aCwgZnVuY3Rpb24gKF9lcnIsIHN0YXRzKSB7XG4gICAgICAgIGlmIChfZXJyKSB7XG4gICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKF9lcnIpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xuICAgICAgICAgIHJlYWRkaXIoZmlsZVBhdGgsIGZ1bmN0aW9uIChfX2VyciwgcmVzKSB7XG4gICAgICAgICAgICBpZiAoX19lcnIpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKF9fZXJyKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaXN0ID0gbGlzdC5jb25jYXQocmVzKVxuICAgICAgICAgICAgcGVuZGluZyAtPSAxXG4gICAgICAgICAgICBpZiAoIXBlbmRpbmcpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIGxpc3QpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsaXN0LnB1c2goZmlsZVBhdGgpXG4gICAgICAgICAgcGVuZGluZyAtPSAxXG4gICAgICAgICAgaWYgKCFwZW5kaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgbGlzdClcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfSlcbiAgICB9KVxuICB9KVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHJlYWRkaXJcbiJdfQ==